<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Recorder Bridge Test</title>
  <style>
	body { font-family: system-ui, -apple-system; margin: 24px; }
	button { padding: 10px 14px; margin: 4px; border-radius: 10px; }
	#log { white-space: pre-wrap; font-family: ui-monospace, SFMono-Regular, Menlo, monospace; }
  </style>
</head>
<body>
  <h1>Recorder Bridge Test</h1>
  <div>
	<button onclick="start()">Start</button>
	<button onclick="pause()">Pause</button>
	<button onclick="resume()">Resume</button>
	<button onclick="stop()">Stop</button>
	<button onclick="cancel()">Cancel</button>
  </div>

  <p>Status: <span id="status">bereit</span></p>
  <audio id="player" controls style="width:100%; display:none;"></audio>
  <pre id="log"></pre>

  <script>
	const $ = sel => document.querySelector(sel);
	function log(...args){ $('#log').textContent += args.join(' ') + '\n'; }

	// Events vom nativen Code:
	window.onRecordingEvent = (evt) => {
	  log('event:', JSON.stringify(evt));
	  $('#status').textContent = evt.type;

	  if (evt.type === 'finished' && evt.url) {
		const player = $('#player');
		player.src = evt.url;    // <- app://recordings/<id>.m4a
		player.style.display = 'block';

		// Beispiel: Upload als Blob (optional)
		// fetch(evt.url).then(r => r.blob()).then(blob => {
		//   const form = new FormData();
		//   form.append('file', blob, `${evt.id}.m4a`);
		//   return fetch('/upload', { method: 'POST', body: form });
		// }).then(r => log('upload status', r.status));
	  }
	};

	// Falls Bootstrap-Script nicht injiziert wurde (sollte es aber):
	if (!window.startRecording) {
	  window.startRecording = (opts) => window.webkit?.messageHandlers?.recorder?.postMessage({action:'start', ...opts});
	  window.pauseRecording  = () => window.webkit?.messageHandlers?.recorder?.postMessage({action:'pause'});
	  window.resumeRecording = () => window.webkit?.messageHandlers?.recorder?.postMessage({action:'resume'});
	  window.stopRecording   = () => window.webkit?.messageHandlers?.recorder?.postMessage({action:'stop'});
	  window.cancelRecording = () => window.webkit?.messageHandlers?.recorder?.postMessage({action:'cancel'});
	}

	// UI-Handler
	function start(){ window.startRecording({ maxSeconds: 0 }); }
	function pause(){ window.pauseRecording(); }
	function resume(){ window.resumeRecording(); }
	function stop(){ window.stopRecording(); }
	function cancel(){ window.cancelRecording(); }

	// Optional: Flag fÃ¼r dein altes Web-UI
	window.isRecording = false;
	const origStart = window.startRecording;
	window.startRecording = (opts) => { window.isRecording = true; origStart(opts); }
	window.pauseRecording = () => { window.isRecording = false; window.webkit.messageHandlers.recorder.postMessage({action:'pause'}); }
	window.resumeRecording = () => { window.isRecording = true; window.webkit.messageHandlers.recorder.postMessage({action:'resume'}); }
	window.stopRecording = () => { window.isRecording = false; window.webkit.messageHandlers.recorder.postMessage({action:'stop'}); }
	window.cancelRecording = () => { window.isRecording = false; window.webkit.messageHandlers.recorder.postMessage({action:'cancel'}); }
  </script>
</body>
</html>

